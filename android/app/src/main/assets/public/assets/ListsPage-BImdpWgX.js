import{d as G,r as i,o as f,c as S,w as s,b as a,u as e,v as K,x as Q,h as y,y as U,z as X,j as D,A as Y,I as $,g as R,i as le,B as ne,k as Z,C as re,D as ie,E as ue,F as ce,a as de,m as r,G as pe,H as w,J as me,K as fe,L as O,M as ve,e as I,N as ge,O as _e,P as he,Q as Ie,R as H,l as be,S as M,T as N,t as b,U as B,V as ye,W as Le,X as J,q as A,Y as z,Z as ke,_ as we,$ as q,a0 as Ue,a1 as Ce,a2 as Se,a3 as De,a4 as Pe,a5 as Ee,a6 as Oe}from"./index-BGNe5PAX.js";import{L as Ne,_ as Ve}from"./ListItemsModal-UwcQ5Qrz.js";const xe=G({__name:"ListEditModal",props:{isOpen:{type:Boolean},initialName:{},initialPublic:{type:Boolean},mode:{}},emits:["update:isOpen","save"],setup(T,{emit:v}){const g=T,_=v,L=i(g.initialName||""),k=i(g.initialPublic||!1),C=()=>{_("update:isOpen",!1)},V=()=>{_("save",{name:L.value,isPublic:k.value}),C()};return(u,l)=>(f(),S(e(re),{"is-open":u.isOpen,onDidDismiss:C},{default:s(()=>[a(e(Y),null,{default:s(()=>[a(e(K),null,{default:s(()=>[a(e(Q),null,{default:s(()=>[y(U(u.mode==="create"?"Nova Lista":"Editar Lista"),1)]),_:1}),a(e(X),{slot:"end"},{default:s(()=>[a(e(D),{onClick:C},{default:s(()=>l[2]||(l[2]=[y("Fechar")])),_:1})]),_:1})]),_:1})]),_:1}),a(e(Z),{class:"ion-padding"},{default:s(()=>[a(e($),null,{default:s(()=>[a(e(R),{position:"stacked"},{default:s(()=>l[3]||(l[3]=[y("Nome da Lista")])),_:1}),a(e(le),{modelValue:L.value,"onUpdate:modelValue":l[0]||(l[0]=h=>L.value=h),placeholder:"Digite o nome da lista",required:""},null,8,["modelValue"])]),_:1}),a(e($),null,{default:s(()=>[a(e(R),null,{default:s(()=>l[4]||(l[4]=[y("Lista Pública")])),_:1}),a(e(ne),{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=h=>k.value=h)},null,8,["modelValue"])]),_:1}),a(e(D),{expand:"block",class:"ion-margin-top",onClick:V,disabled:!L.value},{default:s(()=>[y(U(u.mode==="create"?"Criar":"Salvar"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["is-open"]))}}),Me={key:0,class:"flex justify-center items-center h-full"},Be={key:1,class:"p-4 text-center"},Ae={class:"flex items-center"},qe={key:3,class:"debug-overlay"},$e={class:"debug-content"},Re={class:"debug-text"},Te=G({__name:"ListsPage",setup(T){const v=i([]),g=i(!0),_=i(null);i(!1);const L=de(),k=async()=>{if(r.currentUser)try{g.value=!0,_.value&&_.value();const o=M(N(b,"lists"),B("ownerId","==",r.currentUser.uid)),t=ye(o,n=>{v.value=n.docs.map(c=>({id:c.id,...c.data()})),g.value=!1},n=>{console.error("Erro ao carregar listas:",n),g.value=!1});_.value=t}catch(o){console.error("Erro ao configurar listener:",o),g.value=!1}};ie(()=>{const o=ue(r,t=>{t?k():L.push("/login")});ce(()=>{o(),_.value&&_.value()})});const C=async o=>{var t;try{const n=prompt("Digite o email para compartilhar:");if(!n)return;const c=N(b,"users"),E=M(c,B("email","==",n),De(1)),p=await z(E);if(p.empty){alert("Usuário não encontrado");return}const m=p.docs[0].id,W=A(b,"lists",o),F=await Pe(W);if(!F.exists()){alert("Lista não encontrada");return}const j=F.data();if(j.ownerId!==((t=r.currentUser)==null?void 0:t.uid)){alert("Você não tem permissão para compartilhar esta lista");return}if((j.sharedWith||[]).includes(m)){alert("Lista já compartilhada com este usuário");return}await J(W,{sharedWith:Ee(m)}),alert("Lista compartilhada com sucesso!")}catch(n){console.error("Erro ao compartilhar lista:",n),alert("Erro ao compartilhar lista. Por favor, tente novamente.")}},V=async o=>{try{await Oe(A(b,"lists",o)),v.value=v.value.filter(t=>t.id!==o)}catch(t){console.error("Erro ao deletar lista:",t)}},u=i(!1),l=i(null),h=i("create"),ee=()=>{l.value=null,h.value="create",u.value=!0},ae=o=>{l.value=o,h.value="edit",u.value=!0},te=async o=>{if(!r.currentUser){console.error("Usuário não autenticado"),alert("Você precisa estar autenticado para criar listas");return}try{if(h.value==="create"){const t={name:o.name,isPublic:o.isPublic,ownerId:r.currentUser.uid,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),items:[]};await Le(N(b,"lists"),t),u.value=!1}else{if(!l.value)throw new Error("Nenhuma lista selecionada para edição");const t={name:o.name,isPublic:o.isPublic,updatedAt:new Date().toISOString()};await J(A(b,"lists",l.value.id),t),u.value=!1}}catch(t){console.error("Erro ao salvar lista:",t),alert("Erro ao salvar lista. Por favor, tente novamente.")}},P=i(!1),se=async()=>{if(P.value=!P.value,!r.currentUser){console.log("Usuário não autenticado");return}console.log("Auth state:",{uid:r.currentUser.uid,email:r.currentUser.email});try{const o=N(b,"lists"),t=M(o,B("ownerId","==",r.currentUser.uid)),n=await z(t);console.log("Lists:",n.docs.map(c=>({id:c.id,...c.data()})))}catch(o){console.error("Erro ao carregar listas:",o)}},x=i(!1),oe=o=>{l.value=o,x.value=!0};return(o,t)=>{const n=pe("ion-badge");return f(),S(e(be),null,{default:s(()=>{var c,E;return[a(e(Y),null,{default:s(()=>[a(e(K),null,{default:s(()=>[a(e(Q),null,{default:s(()=>t[3]||(t[3]=[y("Minhas Listas")])),_:1}),a(e(X),{slot:"end"},{default:s(()=>[a(e(D),{onClick:se},{default:s(()=>[a(e(w),{icon:e(me)},null,8,["icon"])]),_:1}),a(e(D),{onClick:ee},{default:s(()=>[a(e(w),{icon:e(fe)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(e(Z),{fullscreen:!0},{default:s(()=>{var p;return[g.value?(f(),O("div",Me,[a(e(ve))])):v.value.length===0?(f(),O("div",Be,t[4]||(t[4]=[I("p",null,"Nenhuma lista encontrada",-1),I("p",{class:"text-sm text-gray-500"},"Clique no + para criar uma nova lista",-1)]))):(f(),S(e(ge),{key:2},{default:s(()=>[(f(!0),O(he,null,_e(v.value,d=>(f(),S(e(ke),{key:d.id},{default:s(()=>[a(e($),{onClick:m=>oe(d)},{default:s(()=>[a(e(R),null,{default:s(()=>{var m;return[I("div",Ae,[I("h2",null,U(d.name),1),d.isOwner?H("",!0):(f(),S(n,{key:0,color:"tertiary",class:"ml-2"},{default:s(()=>t[5]||(t[5]=[y("Compartilhada")])),_:1}))]),I("p",null,U(((m=d.items)==null?void 0:m.length)||0)+" items",1)]}),_:2},1024)]),_:2},1032,["onClick"]),a(e(we),null,{default:s(()=>[a(e(q),{color:"warning",onClick:m=>ae(d)},{default:s(()=>[a(e(w),{icon:e(Ue),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"]),a(e(q),{color:"primary",onClick:m=>C(d.id)},{default:s(()=>[a(e(w),{icon:e(Ce),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"]),a(e(q),{color:"danger",onClick:m=>V(d.id)},{default:s(()=>[a(e(w),{icon:e(Se),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})),P.value?(f(),O("div",qe,[I("div",$e,[a(e(D),{fill:"clear",onClick:t[0]||(t[0]=d=>P.value=!1),class:"close-button"},{default:s(()=>[a(e(w),{icon:e(Ie)},null,8,["icon"])]),_:1}),I("pre",Re,"Auth: "+U((p=e(r).currentUser)==null?void 0:p.uid)+"\nLists: "+U(JSON.stringify(v.value,null,2))+"\n          ",1)])])):H("",!0)]}),_:1}),a(xe,{"is-open":u.value,"onUpdate:isOpen":t[1]||(t[1]=p=>u.value=p),"initial-name":(c=l.value)==null?void 0:c.name,"initial-public":(E=l.value)==null?void 0:E.isPublic,mode:h.value,onSave:te},null,8,["is-open","initial-name","initial-public","mode"]),a(Ne,{"is-open":x.value,"onUpdate:isOpen":t[2]||(t[2]=p=>x.value=p),list:l.value,onListUpdated:k},null,8,["is-open","list"])]}),_:1})}}}),He=Ve(Te,[["__scopeId","data-v-1c927c1b"]]);export{He as default};
